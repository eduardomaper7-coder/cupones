<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Juego de Cartas - Premio</title>
<style>
  :root{
    --bg1:#0b1020;
    --bg2:#2b0b3a;
    --accent1: #ffd700;
    --accent2: #ff6ec7;
    --ticket-border: rgba(217,180,75,0.65);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#fff;background:linear-gradient(180deg,var(--bg1),#1b0526 40%, #230b2f 100%);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
  .app{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:18px;box-sizing:border-box;}
  .topbar{width:100%;max-width:520px;display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
  .ticket{background:linear-gradient(180deg,#ffffff,#f8f6f2);color:#111;border:1px solid var(--ticket-border);padding:6px 10px;border-radius:10px;box-shadow:0 8px 24px rgba(249,213,86,0.09);display:flex;align-items:center;gap:6px;font-weight:700;min-width:54px;justify-content:center;}
  .ticket.small{padding:4px 8px;min-width:44px;}
  .coins-circle{width:64px;height:64px;border-radius:999px;border:2px solid rgba(255,255,255,0.12);display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(255,255,255,0.03);font-weight:700;}
  .center-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;width:100%;max-width:520px;padding:6px;box-sizing:border-box;}
  .headline{font-size:20px;text-align:center;font-weight:800;margin-bottom:12px;line-height:1.05;animation:pulseSpark 1.6s infinite;}
  @keyframes pulseSpark{
    0%{text-shadow:0 0 6px rgba(255,255,255,0.0);transform:translateY(0);opacity:0.95}
    40%{text-shadow:0 0 20px rgba(255,255,255,0.9);transform:translateY(-4px);opacity:1}
    100%{text-shadow:0 0 6px rgba(255,255,255,0.0);transform:translateY(0);opacity:0.96}
  }
  .cards-row{display:flex;gap:14px;align-items:center;justify-content:center;touch-action:manipulation;padding:10px;}
  .card-wrap{width:110px;height:160px;perspective:1200px;}
  .card{width:100%;height:100%;border-radius:14px;position:relative;transform-style:preserve-3d;transition:transform .6s ease,filter .3s ease,opacity .3s ease;box-shadow:0 18px 40px rgba(0,0,0,0.6);cursor:pointer;}
  .card.disable{pointer-events:none;}
  .card-face{position:absolute;inset:0;border-radius:14px;backface-visibility:hidden;display:flex;align-items:center;justify-content:center;padding:10px;box-sizing:border-box;}
  .card-back{background:linear-gradient(135deg,#6b21a8,#ec4899);color:#fff;font-weight:800;font-size:14px;}
  .card-front{background:#fff;color:#111;transform:rotateY(180deg);display:flex;flex-direction:column;gap:6px;align-items:center;justify-content:center;}
  .prize-title{font-weight:900;font-size:14px;text-align:center;}
  .prize-desc{font-size:12px;color:#333;text-align:center;padding:0 8px;}
  .card.flipped{transform:rotateY(180deg) scale(1.08);z-index:40;}
  .card.dim{filter:grayscale(100%) brightness(.75);opacity:.35;pointer-events:none;}
  .progress-wrap{width:100%;max-width:520px;margin-top:12px;margin-bottom:6px;}
  .progress-label{font-size:12px;text-align:center;margin-bottom:6px;}
  .progress-bar{width:100%;height:10px;background:rgba(255,255,255,0.08);border-radius:999px;overflow:hidden;}
  .progress-fill{height:100%;width:20%;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width .75s ease;border-radius:999px;}
  .controls{display:flex;justify-content:center;gap:10px;margin-top:6px;}
  button.btn{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);color:#fff;padding:8px 12px;border-radius:999px;font-weight:700;}
  /* shuffle animation small */
  @keyframes shuffleA{0%{transform:translateY(0) rotate(0);}25%{transform:translateY(-8px) rotate(-6deg);}50%{transform:translateY(6px) rotate(6deg);}75%{transform:translateY(-4px) rotate(-2deg);}100%{transform:translateY(0) rotate(0);}}
  .shuffling{animation:shuffleA .36s infinite;}

  /* confetti pieces */
  .confetti-container{position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:80;}
  .confetti{position:absolute;width:10px;height:6px;border-radius:2px;opacity:0;transform-origin:center;animation:confettiFall 2s forwards ease-in;}
  @keyframes confettiFall{0%{transform:translateY(-10vh) rotate(0deg);opacity:1}100%{transform:translateY(110vh) rotate(720deg);opacity:1}}

  /* coins */
  .coin{width:36px;height:36px;border-radius:999px;background:linear-gradient(180deg,#ffd86b,#f7c32b);display:flex;align-items:center;justify-content:center;font-weight:800;color:#8b5e00;border:2px solid rgba(0,0,0,0.08);box-shadow:0 10px 18px rgba(0,0,0,0.35);}
  .coin-fly{position:absolute;animation:coinFloat 1.4s forwards ease-out;pointer-events:none;z-index:85;}
  @keyframes coinFloat{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-140px) scale(1.05);opacity:0}}

  /* Fullscreen ticket reveal */
  .ticket-full{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:200;pointer-events:none;}
  .ticket-big{background:linear-gradient(180deg,#ffffff,#f8f6f2);color:#111;border:3px solid var(--ticket-border);padding:18px 28px;border-radius:14px;box-shadow:0 30px 80px rgba(0,0,0,0.6);transform:scale(0.85);transition:transform .6s cubic-bezier(.2,.9,.2,1),opacity .6s;opacity:0;}
  .ticket-big.show{transform:scale(1);opacity:1;pointer-events:auto;}
  .ticket-big h2{margin:0;font-size:22px;letter-spacing:1px;}
  .ticket-small-appear{animation:popIn .5s ease forwards;}
  @keyframes popIn{0%{transform:scale(.6);opacity:0}100%{transform:scale(1);opacity:1}}

  /* responsive */
  @media(min-width:420px){ .card-wrap{width:128px;height:180px;} .coins-circle{width:76px;height:76px;} .headline{font-size:24px} }
</style>
</head>
<body>
<div class="app" id="app">
  <div class="topbar">
    <div class="ticket small" id="euros-ticket">€ <span id="euros">0</span></div>
    <div class="coins-circle" id="center-coins"><div style="font-size:11px">COINS</div><div id="coins" style="font-size:15px">0</div></div>
    <div class="ticket small" id="discount-ticket"> % <span id="discount">0</span></div>
  </div>

  <div class="center-area">
    <div class="headline" id="headline">Elige bien, tu premio te espera detrás de una carta</div>

    <div class="cards-row" id="cardsRow" aria-hidden="false">
      <div class="card-wrap">
        <div class="card" data-index="0" id="card0">
          <div class="card-face card-back">Elige tu carta</div>
          <div class="card-face card-front">
            <div class="prize-title">Pase gratuito fitness</div>
            <div class="prize-desc">Pase gratuito a un centro fitness</div>
          </div>
        </div>
      </div>

      <div class="card-wrap">
        <div class="card" data-index="1" id="card1">
          <div class="card-face card-back">Elige tu carta</div>
          <div class="card-face card-front">
            <div class="prize-title">10% DTO. en tu próxima compra</div>
            <div class="prize-desc">Descuento especial</div>
          </div>
        </div>
      </div>

      <div class="card-wrap">
        <div class="card" data-index="2" id="card2">
          <div class="card-face card-back">Elige tu carta</div>
          <div class="card-face card-front">
            <div class="prize-title">2000 Coins</div>
            <div class="prize-desc">Coins para canjear</div>
          </div>
        </div>
      </div>
    </div>

    <div class="confetti-container" id="confetti"></div>
    <div id="coinLayer"></div>

    <div id="celebrateBanner" style="position:absolute;top:40%;left:50%;transform:translate(-50%,-50%);z-index:90;display:none;">
      <div style="background:rgba(255,255,255,0.07);backdrop-filter:blur(6px);padding:12px 16px;border-radius:12px;text-align:center;">
        <div style="font-size:18px;font-weight:900;margin-bottom:6px;">¡Felicidades!</div>
        <div style="font-size:14px;">Has ganado: <span id="prizeText" style="font-weight:900"></span></div>
      </div>
    </div>
  </div>

  <div class="progress-wrap">
    <div class="progress-label">Progreso: <span id="progressValue">20</span>%</div>
    <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:20%"></div></div>
  </div>

  <div class="controls">
    <button class="btn" id="resetBtn">Volver a jugar</button>
  </div>

  <!-- fullscreen big ticket reveal for euros and discount -->
  <div class="ticket-full" id="ticketFull" aria-hidden="true">
    <div class="ticket-big" id="ticketBig">
      <h2 id="ticketBigText">+€0</h2>
    </div>
  </div>
</div>

<script>
(function(){
  // state
  const cards = Array.from(document.querySelectorAll('.card'));
  const confettiLayer = document.getElementById('confetti');
  const coinLayer = document.getElementById('coinLayer');
  const eurosEl = document.getElementById('euros');
  const discountEl = document.getElementById('discount');
  const coinsEl = document.getElementById('coins');
  const progressEl = document.getElementById('progressValue');
  const progressFill = document.getElementById('progressFill');
  const celebrateBanner = document.getElementById('celebrateBanner');
  const prizeTextEl = document.getElementById('prizeText');
  const ticketFull = document.getElementById('ticketFull');
  const ticketBig = document.getElementById('ticketBig');
  const ticketBigText = document.getElementById('ticketBigText');
  const resetBtn = document.getElementById('resetBtn');
  let phase = 'intro'; // intro -> shuffling -> choose -> reveal -> celebrate
  let revealedIndex = null;
  let euros = 0, discount = 0, coins = 0, progress = 20;

  const prizes = [
    { id:0, title:'Pase gratuito fitness', desc:'Pase gratuito a un centro fitness' },
    { id:1, title:'10% DTO. en tu próxima compra', desc:'Descuento especial' },
    { id:2, title:'2000 Coins', desc:'Coins para canjear' }
  ];

  function setProgress(p){
    progress = Math.max(0, Math.min(100, p));
    progressEl.textContent = progress;
    progressFill.style.width = progress + '%';
  }

  function animateNumber(el, from, to, ms){
    const start = performance.now();
    return new Promise(resolve=>{
      function step(t){
        const tt = Math.min(1, (t-start)/ms);
        const val = Math.round(from + (to-from)*tt);
        el.textContent = val;
        if(tt < 1) requestAnimationFrame(step);
        else resolve();
      }
      requestAnimationFrame(step);
    });
  }

  // start intro then shuffle
  setTimeout(()=> startShuffling(), 600);

  function startShuffling(){
    phase = 'shuffling';
    // add shuffling effect for a while
    cards.forEach(c => c.classList.add('shuffling'));
    // after 1400-2200ms stop shuffle
    setTimeout(()=>{
      cards.forEach(c => c.classList.remove('shuffling'));
      phase = 'choose';
    }, 2000);
  }

  // attach listeners
  cards.forEach(card => {
    card.addEventListener('click', ()=> {
      const idx = parseInt(card.dataset.index,10);
      if(phase !== 'choose') return;
      chooseCard(idx);
    });
  });

  function chooseCard(idx){
    phase = 'reveal';
    revealedIndex = idx;
    // flip chosen card
    const chosenCard = document.getElementById('card'+idx);
    chosenCard.classList.add('flipped');
    // dim others
    cards.forEach(c => { if(c !== chosenCard) c.classList.add('dim'); });
    // after a short delay show prize effects
    setTimeout(()=> {
      showPrizeEffects(idx);
    }, 600);
  }

  function showPrizeEffects(idx){
    const prize = prizes[idx];
    prizeTextEl.textContent = prize.desc || prize.title;
    celebrateBanner.style.display = 'block';

    // confetti + coins
    spawnConfetti();
    spawnCoins();

    // random increments
    const addEuros = Math.floor(Math.random()*6)+5; //5..10
    const addDisc = Math.floor(Math.random()*11)+5; //5..15
    const addCoins = Math.floor(Math.random()*1001)+1000; //1000..2000

    // show big euros ticket first (fullscreen), animate number
    ticketBigText.textContent = '+€0';
    ticketFull.style.display = 'block';
    ticketFull.setAttribute('aria-hidden','false');
    setTimeout(()=>{
      ticketBig.classList.add('show');
      // animate euros number in the small ticket too while showing big ticket
      animateNumber(eurosEl, euros, euros+addEuros, 900).then(()=>{});
      animateNumber(ticketBigText, 0, addEuros, 900).then(()=>{
        // after showing euros, hide big ticket and show discount and coins
        setTimeout(()=>{
          ticketBig.classList.remove('show');
          ticketFull.style.display = 'none';
          ticketFull.setAttribute('aria-hidden','true');
          // animate discount
          setTimeout(()=>{
            animateNumber(discountEl, discount, discount+addDisc, 900);
          }, 260);
          // animate coins small center
          setTimeout(()=>{
            animateNumber(coinsEl, coins, coins+addCoins, 1000);
          }, 420);
        }, 900);
      });
      // finalize state values
      euros += addEuros;
      discount += addDisc;
      coins += addCoins;
      setProgress(progress + 20);
    }, 120);

    // show celebration overlay text briefly then keep
    setTimeout(()=>{
      celebrateBanner.style.opacity = '1';
    }, 300);
  }

  function spawnConfetti(){
    confettiLayer.innerHTML = '';
    const count = 26;
    for(let i=0;i<count;i++){
      const el = document.createElement('div');
      el.className = 'confetti';
      el.style.left = Math.random()*90+'%';
      el.style.background = `linear-gradient(90deg, rgba(${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},1), rgba(${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},1))`;
      el.style.top = -(Math.random()*8+8)+'vh';
      el.style.transform = `rotate(${Math.random()*360}deg)`;
      el.style.animationDelay = (Math.random()*0.6)+'s';
      el.style.width = (6 + Math.random()*12)+'px';
      el.style.height = (4 + Math.random()*8)+'px';
      confettiLayer.appendChild(el);
      setTimeout(()=> el.remove(), 2400 + Math.random()*600);
    }
  }

  function spawnCoins(){
    // create some floating coins from the chosen card position
    const startX = window.innerWidth/2;
    const startY = window.innerHeight/2;
    const count = 8;
    coinLayer.innerHTML = '';
    for(let i=0;i<count;i++){
      const el = document.createElement('div');
      el.className = 'coin-fly';
      el.style.left = (30 + i*6)+'%';
      el.style.top = (50 - i*4)+'%';
      const coin = document.createElement('div');
      coin.className = 'coin';
      coin.textContent = '¢';
      el.appendChild(coin);
      coinLayer.appendChild(el);
      // randomize animation delay
      el.style.animationDelay = (i*0.06)+'s';
      setTimeout(()=> el.remove(), 1400 + i*40);
    }
  }

  resetBtn.addEventListener('click', ()=>{
    // reset
    phase = 'intro';
    revealedIndex = null;
    cards.forEach(c => { c.classList.remove('flipped','dim'); });
    euros = 0; discount = 0; coins = 0;
    eurosEl.textContent = '0'; discountEl.textContent = '0'; coinsEl.textContent = '0';
    setProgress(20);
    celebrateBanner.style.display = 'none';
    confettiLayer.innerHTML='';
    coinLayer.innerHTML='';
    ticketFull.style.display='none';
    ticketBig.classList.remove('show');
    // restart shuffle after small delay
    setTimeout(()=> startShuffling(), 260);
  });

  // accessibility: allow keyboard choose for dev/testing
  cards.forEach((c, i) => { c.tabIndex=0; c.addEventListener('keypress', (e)=>{ if(e.key==='Enter') chooseCard(i); }); });

})(); // end closure
</script>
</body>
</html>
