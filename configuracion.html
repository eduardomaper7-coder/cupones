<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Confirmar reserva</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#111;color:#fff;padding:20px}
    h1{text-align:center}
    .contador{text-align:center;font-size:28px;margin:20px 0;color:#facc15;font-weight:900}
    .resumen{text-align:center;margin:20px 0}
    label{display:block;margin:10px 0 4px}
    input,select{width:100%;padding:8px;border-radius:6px;border:none;margin-bottom:12px}
    button{padding:12px 24px;font-weight:900;background:#e11d48;color:#fff;border:none;border-radius:20px;cursor:pointer}
  </style>
</head>
<body>
  <h1>Confirmar reserva</h1>
  <div class="contador" id="contador">05:00</div>
  <div class="resumen" id="resumen"></div>

  <form id="form">
    <label>Elige día</label>
    <input type="date" id="fecha" required>
    <label>Elige hora</label>
    <input type="time" id="hora" required>
    <label>Nombre</label>
    <input type="text" name="nombre" required>
    <label>Apellidos</label>
    <input type="text" name="apellidos" required>
    <label>Teléfono (Te enviaremos por WhatsApp tus premios)</label>
    <input type="tel" name="telefono" required>
    <button type="submit">Confirmar reserva</button>
  </form>

  <script>
    const act=localStorage.getItem("actividad");
    const precio=parseFloat(localStorage.getItem("precio")||0);
    const ganado=parseFloat(localStorage.getItem("totalEuros")||0);
    const ahorro=Math.min(ganado,precio).toFixed(2);
    const pagar=(precio-ganado>0?(precio-ganado):0).toFixed(2);

    document.getElementById("resumen").innerHTML=`
      <div><strong>Opción:</strong> ${act}</div>
      <div>Ahorras: ${ahorro}€</div>
      <div>A pagar: ${pagar}€</div>
    `;

    // Contador 5 min
    let segundos=300;
    function tick(){
      let m=Math.floor(segundos/60);
      let s=segundos%60;
      document.getElementById("contador").textContent=`${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
      if(segundos>0){segundos--;setTimeout(tick,1000);}
    }
    tick();

    // Limitar fecha y hora
    const fecha=document.getElementById("fecha");
    const hoy=new Date();
    const max=new Date();
    max.setDate(hoy.getDate()+7);
    fecha.min=hoy.toISOString().split("T")[0];
    fecha.max=max.toISOString().split("T")[0];

    document.getElementById("form").addEventListener("submit",function(e){
      e.preventDefault();

      // Validar día de la semana y hora
      const f=new Date(fecha.value+"T"+document.getElementById("hora").value);
      const dia=f.getDay();
      const hora=f.getHours(), min=f.getMinutes();
      let valido=false;

      if(dia>=1 && dia<=5){ // lunes a viernes
        if(hora>=10 && (hora<20 || (hora===20 && min<=30))) valido=true;
      }else if(dia===6){ // sábado
        if(hora>=10 && (hora<13 || (hora===13 && min<=30))) valido=true;
      }else{
        alert("Domingo cerrado");
        return;
      }

      if(!valido){alert("Hora no disponible");return;}

      // Enviar a Google Sheets
      fetch("TU_URL_DE_GOOGLE_SCRIPT",{
        method:"POST",
        body:new FormData(this)
      }).then(r=>alert("Reserva confirmada ✅"))
      .catch(err=>alert("Error al enviar"));
    });
  </script>
</body>
</html>
