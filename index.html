<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Promo Fitness â€” Juego</title>
  <style>
    :root{
      --bg1:#0a0a0a;--bg2:#18181b;--txt:#fff;--amber:#f59e0b;--amber2:#facc15;
    }
    html,body{margin:0;height:100%;background:linear-gradient(#000,#0b0b0b);color:var(--txt);font-family:system-ui,Roboto,sans-serif}
    .app{padding:76px 12px 88px;min-height:100dvh}
    .top{position:fixed;top:8px;left:8px;right:8px;display:flex;justify-content:center;gap:8px;z-index:40;flex-wrap:wrap}
    .ticket,.coins{background:#fff;color:#7c5a00;border:1px solid #f1d48b;border-radius:12px;padding:6px 12px;display:flex;align-items:center;gap:8px;box-shadow:0 6px 16px rgba(0,0,0,.35);font-size:16px}
    .coins{border-radius:999px}
    .coins .badge{width:30px;height:30px;border-radius:50%;border:1px solid #f1d48b;display:grid;place-items:center}
    .title{text-align:center;font-weight:900;font-size:20px;background:linear-gradient(90deg,#fde68a,#f59e0b);-webkit-background-clip:text;color:transparent;margin-bottom:12px}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(90px,1fr));gap:12px;justify-items:center}
    .card{width:100%;max-width:110px;height:160px;perspective:1000px;cursor:pointer}
    .card-inner{width:100%;height:100%;position:relative;transform-style:preserve-3d;border-radius:16px;border:1px solid #3f3f46;transition:transform .8s}
    .card-inner.flipped{transform:rotateY(180deg)}
    .card-inner.zoomed{transform:rotateY(180deg) scale(1.2)}
    .card-face{position:absolute;inset:0;display:grid;place-items:center;backface-visibility:hidden;border-radius:16px}
    .card-back{color:#facc15;font-size:22px}
    .card-front{background:linear-gradient(135deg,#fde68a,#facc15);color:#111;transform:rotateY(180deg);font-weight:900;text-align:center;font-size:16px}
    .msg{text-align:center;margin-top:16px;font-weight:800;color:#fde68a}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:grid;place-items:center;z-index:50;animation:fade .2s}
    .bigbox{background:#fff;color:#1f2937;border:3px solid #f1d48b;border-radius:22px;padding:20px;box-shadow:0 20px 40px rgba(0,0,0,.5);font-weight:900;text-align:center;font-size:22px;max-width:90%}
    @keyframes fade{from{opacity:0}to{opacity:1}}
    .btn{background:linear-gradient(180deg,#f59e0b,#d97706);color:#111;font-weight:800;border:none;border-radius:16px;padding:12px 16px;box-shadow:0 6px 12px rgba(0,0,0,.4);cursor:pointer;font-size:16px;margin-top:8px;animation:pulse 1.8s infinite}
    .btn[disabled]{opacity:.5;filter:grayscale(1)}
    .next-fixed{position:fixed;left:0;right:0;bottom:70px;display:flex;justify-content:center;z-index:30}
    .confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:30}
    .confetti span{position:absolute;width:8px;height:8px;animation:fall linear forwards;will-change:transform}
    @keyframes fall{to{transform:translateY(120vh) rotate(720deg);opacity:.9}}
    .wheel-wrap{margin:20px auto;width:90vw;max-width:320px;aspect-ratio:1;position:relative;display:flex;justify-content:center;align-items:center}
    .wheel{position:absolute;inset:0;border:6px solid #facc15;border-radius:50%;overflow:hidden;background:#27272a;box-shadow:0 0 30px 10px rgba(250,204,21,0.6),0 0 60px 20px rgba(250,204,21,0.4)}
    .arrow{position:absolute;left:50%;transform:translateX(-50%);top:-12px;width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:28px solid #fbbf24;z-index:2}
    .hub{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:70px;height:70px;border-radius:50%;background:radial-gradient(circle,#fff,#fde68a);border:3px solid #f59e0b;display:grid;place-items:center;font-weight:900;color:#7a4a00;font-size:14px;cursor:pointer}
    .slice-label{position:absolute;left:50%;top:50%;transform-origin:center;font-weight:900;font-size:16px;text-shadow:0 1px 2px rgba(0,0,0,.35);width:140px;text-align:center;color:#facc15}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.07)}100%{transform:scale(1)}}
  </style>
</head>
<body>
  <div class="top">
    <div class="ticket">â‚¬ ganados: <span id="euros">0â‚¬</span></div>
    <div class="coins"><div class="badge">ðŸ’°</div><div id="coins">0</div></div>
  </div>

  <main id="screen" class="app"></main>

<script>
(function(){
  const $ = (s,root=document)=>root.querySelector(s);
  const state={step:0,euros:0,coins:0};
  function setStats(){ $("#euros").textContent=state.euros.toFixed(2)+"â‚¬"; $("#coins").textContent=state.coins; }
  function mount(node){const scr=$("#screen");scr.innerHTML="";scr.appendChild(node);return node;}

  // --- Confetti ---
  function launchConfetti(){
    const root=document.createElement("div");root.className="confetti";document.body.appendChild(root);
    for(let i=0;i<150;i++){
      const s=document.createElement("span");
      s.style.left=Math.random()*100+"%";
      s.style.top="-10%";
      s.style.background=`hsl(${Math.random()*360} 90% 60%)`;
      s.style.transform=`rotate(${Math.random()*360}deg)`;
      s.style.animationDuration=(2+Math.random()*2)+'s';
      root.appendChild(s);setTimeout(()=>s.remove(),4200);
    }
    setTimeout(()=>root.remove(),4500);
  }

  // --- Popup counter ---
  function popupCount(label,target,suf,cb){
    const ov=document.createElement("div");ov.className="overlay";
    ov.innerHTML=`<div class="bigbox"><div style="font-size:18px;color:#475569">${label}</div><div id="count" style="font-size:36px;color:#a16207">0${suf}</div></div>`;
    document.body.appendChild(ov);
    const count=ov.querySelector("#count");const start=performance.now();const dur=1200;
    function tick(t){const p=Math.min(1,(t-start)/dur);const v=Math.round(target*p);count.textContent=v+suf;
      if(p<1)requestAnimationFrame(tick);else setTimeout(()=>{ov.remove();cb&&cb();},500);}
    requestAnimationFrame(tick);
  }

  // --- Screen 1: Cards ---
  function screenCards(){
    const root=document.createElement("div");
    root.innerHTML=`<div class="title">Elige tu carta</div><div class="cards" id="cards"></div><div class="msg" id="msg"></div><div class="next-fixed"><button class="btn" id="next" disabled>Siguiente âžœ</button></div>`;
    const wrap=root.querySelector("#cards");
    for(let i=0;i<6;i++){
      const el=document.createElement("div");el.className="card";
      el.innerHTML=`<div class="card-inner"><div class="card-face card-back">âœ¨</div><div class="card-face card-front"><div>Pase gratuito<br>FITNESS</div></div></div>`;
      wrap.appendChild(el);
      el.addEventListener("click",()=>{
        if(root.querySelector(".flipped"))return;
        const inner=el.querySelector(".card-inner");
        inner.classList.add("flipped");
        setTimeout(()=>inner.classList.add("zoomed"),800);
        setTimeout(()=>launchConfetti(),1000);
        setTimeout(()=>popupCount("â‚¬ ganados",6,"â‚¬",()=>popupCount("Coins",1000,"",( )=>{
          state.euros=6;state.coins=1000;setStats();root.querySelector("#next").disabled=false;})),1200);
        root.querySelector("#msg").textContent="Â¡Has conseguido un pase!";
      });
    }
    root.querySelector("#next").addEventListener("click",()=>screenWheel());
    return mount(root);
  }

  // --- Screen 2: Wheel ---
  const PRIZES=["2â‚¬","5â‚¬","10â‚¬","15â‚¬","20â‚¬","25â‚¬"];
  function screenWheel(){
    const root=document.createElement("div");
    root.innerHTML=`<div style="text-align:center;font-size:20px;font-weight:900;margin-bottom:6px">Â¡Gira la ruleta!</div>
      <div style="text-align:center;color:#d4d4d8;margin-bottom:16px;font-size:14px">Coste: 500 coins</div>
      <div class="wheel-wrap"><div class="arrow"></div><div class="wheel" id="wheel"><div class="hub">GIRAR</div></div></div>
      <div style="margin-top:18px;display:flex;justify-content:center"><button class="btn" id="spin">Girar por 500 coins</button></div>`;
    const wheel=root.querySelector("#wheel");const spinBtn=root.querySelector("#spin");
    buildWheel(wheel,PRIZES);
    let spinning=false,angle=0;
    spinBtn.addEventListener("click",()=>{
      if(spinning||state.coins<500)return alert("No tienes coins");
      state.coins-=500;setStats();
      spinning=true;const seg=360/PRIZES.length;const idx=Math.floor(Math.random()*PRIZES.length);
      const target=360*6+(360-(idx*seg+seg/2));
      const start=performance.now();const dur=4200;const startA=angle;
      function tick(t){const p=Math.min(1,(t-start)/dur);angle=startA+(target-startA)*(1-Math.pow(1-p,3));wheel.style.transform=`rotate(${angle}deg)`;if(p<1)requestAnimationFrame(tick);else done();}
      requestAnimationFrame(tick);
      function done(){spinning=false;showPrize(PRIZES[idx]);}
    });
    return mount(root);
  }

  function buildWheel(el,labels){
    const n=labels.length;const seg=360/n;
    let stops=[];for(let i=0;i<n;i++){const a0=i*seg,a1=(i+1)*seg;stops.push(`${i%2?"#fde68a":"#fff"} ${a0}deg ${a1}deg`);}
    el.style.background=`conic-gradient(${stops.join(",")})`;
    el.querySelectorAll(".slice-label").forEach(n=>n.remove());
    for(let i=0;i<n;i++){const part=document.createElement("div");part.className="slice-label";
      part.style.transform=`translate(-50%,-50%) rotate(${i*seg+seg/2}deg) translateY(-120px)`;
      part.textContent=labels[i];el.appendChild(part);}
  }

  function showPrize(prize){
    const ov=document.createElement("div");ov.className="overlay";
    ov.innerHTML=`<div class="bigbox"><div style="font-size:28px;color:#22c55e">ðŸŽ‰ Â¡Premio obtenido! ðŸŽ‰</div>
    <div style="color:#a16207;margin-top:12px;font-weight:900;font-size:34px">${prize}</div>
    <div style="margin-top:20px"><a href="reserva.html" class="btn">Siguiente âžœ</a></div></div>`;
    document.body.appendChild(ov);
  }

  // init
  setStats();screenCards();
})();
</script>
</body>
</html>

