<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Promo Fitness — Juego Completo</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#111;color:#fff;min-height:100vh;padding:16px}
    .hidden{display:none}
    h1,h2{text-align:center}
    .btn{padding:12px 24px;border:none;border-radius:24px;font-weight:900;cursor:pointer}
    .btn-gold{background:linear-gradient(#222,#000);color:#ffd700;border:2px solid #ffd700}
    .btn-red{background:linear-gradient(#ff4d4d,#b30000);color:#ffd700;border:2px solid #ffd700}
    .top{display:flex;justify-content:center;gap:12px;margin-bottom:12px}
    .ticket,.coins{background:#fff;color:#333;border-radius:12px;padding:6px 12px;font-weight:700}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(90px,1fr));gap:12px;justify-items:center}
    .card{width:100%;max-width:110px;height:160px;perspective:1000px;cursor:pointer}
    .card-inner{width:100%;height:100%;position:relative;transform-style:preserve-3d;border-radius:16px;border:1px solid #444;transition:transform .8s}
    .card-inner.flipped{transform:rotateY(180deg)}
    .card-face{position:absolute;inset:0;display:grid;place-items:center;backface-visibility:hidden;border-radius:16px}
    .card-back{color:#facc15;font-size:22px}
    .card-front{background:linear-gradient(135deg,#fde68a,#facc15);color:#111;transform:rotateY(180deg);font-weight:900;text-align:center;font-size:16px}
    .wheel-wrap{margin:20px auto;width:90vw;max-width:320px;aspect-ratio:1;position:relative;display:flex;justify-content:center;align-items:center}
    .wheel{position:absolute;inset:0;border:6px solid #ffd700;border-radius:50%;overflow:hidden;background:#27272a;box-shadow:0 0 30px 10px rgba(250,204,21,0.6)}
    .arrow{position:absolute;left:50%;transform:translateX(-50%);top:-12px;width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:28px solid #fbbf24;z-index:2}
    .hub{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:70px;height:70px;border-radius:50%;background:radial-gradient(circle,#fff,#fde68a);border:3px solid #f59e0b;display:grid;place-items:center;font-weight:900;color:#7a4a00;font-size:14px;cursor:pointer}
    .slice-label{position:absolute;left:50%;top:50%;transform-origin:center;font-weight:900;font-size:18px;text-shadow:0 2px 4px rgba(0,0,0,.7);width:140px;text-align:center;color:#fff}
    .actividad{border:2px solid #333;padding:12px;margin:12px 0;border-radius:12px;cursor:pointer}
    .precio.rojo{color:#e11d48}
    .precio.verde{color:#16a34a}
    .monedero{text-align:center;margin-top:20px;font-size:20px;font-weight:900;color:#facc15}
    .contador-box{text-align:center;border:3px solid #facc15;padding:12px;border-radius:12px;margin:20px auto;width:180px;background:#1f1f1f;box-shadow:0 0 10px rgba(250,204,21,.5)}
    .contador{font-size:32px;color:#facc15;font-weight:900}
    .resumen{text-align:center;margin:20px 0}
    .opcion{font-size:24px;font-weight:900;margin-bottom:12px}
    .ahorro{font-size:22px;font-weight:900;color:#facc15;margin-bottom:8px}
    .pagar{font-size:20px;font-weight:700;color:#fff}
  </style>
</head>
<body>

<!-- Pantalla Cartas -->
<div id="screen-cartas">
  <div class="top"><div class="ticket">€ ganados: <span id="euros">0€</span></div><div class="coins">Coins: <span id="coins">0</span></div></div>
  <h1>Elige bien, tu premio te espera detrás de una carta</h1>
  <div class="cards" id="cards"></div>
  <div style="text-align:center;margin-top:20px"><button class="btn btn-gold" id="to-ruleta" disabled>Siguiente ➜</button></div>
</div>

<!-- Pantalla Ruleta -->
<div id="screen-ruleta" class="hidden">
  <div class="top"><div class="ticket">€ ganados: <span id="euros2">0€</span></div><div class="coins">Coins: <span id="coins2">0</span></div></div>
  <h1>¡Gira la ruleta!</h1>
  <div class="wheel-wrap"><div class="arrow"></div><div class="wheel" id="wheel"><div class="hub">GIRAR</div></div></div>
  <div style="text-align:center;margin-top:20px"><button class="btn btn-red" id="spin">GIRAR YA</button></div>
</div>

<!-- Pantalla Reserva -->
<div id="screen-reserva" class="hidden">
  <h1>Elige tu actividad</h1>
  <h2>Contamos con más de 100 centros afiliados cerca de ti.</h2>
  <div id="actividades"></div>
  <div class="monedero">Tu monedero: <span id="monedero">0€</span></div>
</div>

<!-- Pantalla Confirmación -->
<div id="screen-confirmacion" class="hidden">
  <h1>Confirmar reserva</h1>
  <div class="contador-box"><div class="contador" id="contador">05:00</div></div>
  <div class="resumen" id="resumen"></div>
  <form id="form">
    <label>Elige día</label><input type="date" id="fecha" name="fecha" required>
    <label>Elige hora</label><input type="time" id="hora" name="hora" required>
    <label>Nombre</label><input type="text" name="nombre" required>
    <label>Apellidos</label><input type="text" name="apellidos" required>
    <label>Teléfono (Te enviaremos por WhatsApp tus premios)</label><input type="tel" name="telefono" required>
    <button type="submit" class="btn btn-red">Confirmar reserva</button>
  </form>
</div>

<script>
(function(){
  let euros=0, coins=0, actividadSel=null, precioSel=0;

  function show(id){
    document.querySelectorAll("body>div").forEach(d=>d.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
  }
  function setStats(){document.getElementById("euros").textContent=euros+"€";document.getElementById("coins").textContent=coins;document.getElementById("euros2").textContent=euros+"€";document.getElementById("coins2").textContent=coins;}

  // CARTAS
  const cardsDiv=document.getElementById("cards");
  for(let i=0;i<6;i++){
    const c=document.createElement("div");c.className="card";
    c.innerHTML=`<div class="card-inner"><div class="card-face card-back">✨</div><div class="card-face card-front">Premio</div></div>`;
    cardsDiv.appendChild(c);
    c.addEventListener("click",()=>{
      if(cardsDiv.querySelector(".flipped"))return;
      c.querySelector(".card-inner").classList.add("flipped");
      const premio=Math.floor(Math.random()*5)+1; // 1-5€
      euros=premio;coins=1000;setStats();
      document.getElementById("to-ruleta").disabled=false;
    });
  }
  document.getElementById("to-ruleta").onclick=()=>show("screen-ruleta");

  // RULETA
  const PRIZES=["2","5","10","15","20","25"];
  const wheel=document.getElementById("wheel");
  function buildWheel(){
    const n=PRIZES.length,seg=360/n;
    let stops=[];for(let i=0;i<n;i++){stops.push(`${i%2?"#fde68a":"#fff"} ${i*seg}deg ${(i+1)*seg}deg`);}
    wheel.style.background=`conic-gradient(${stops.join(",")})`;
    wheel.querySelectorAll(".slice-label").forEach(n=>n.remove());
    for(let i=0;i<n;i++){const part=document.createElement("div");part.className="slice-label";
      part.style.transform=`translate(-50%,-50%) rotate(${i*seg+seg/2}deg) translateY(-120px)`;
      part.textContent=PRIZES[i]+"€";wheel.appendChild(part);}
  }
  buildWheel();
  let angle=0;
  document.getElementById("spin").onclick=()=>{
    if(coins<500)return alert("No tienes coins suficientes");
    coins-=500;setStats();
    let premio;
    if(euros===5){premio=2;}
    else{
      const min=5.5-euros,max=7-euros;
      let posibles=PRIZES.map(Number).filter(v=>v>=min&&v<=max);
      if(!posibles.length)posibles=[2];
      premio=posibles[Math.floor(Math.random()*posibles.length)];
    }
    const idx=PRIZES.indexOf(String(premio));
    const seg=360/PRIZES.length;
    const target=360*6+(360-(idx*seg+seg/2));
    const start=performance.now(),dur=4200,startA=angle;
    function tick(t){
      const p=Math.min(1,(t-start)/dur);
      angle=startA+(target-startA)*(1-Math.pow(1-p,3));
      wheel.style.transform=`rotate(${angle}deg)`;
      if(p<1)requestAnimationFrame(tick);else finish();
    }
    requestAnimationFrame(tick);
    function finish(){
      euros+=premio;setStats();
      show("screen-reserva");
      initReserva();
    }
  };

  // RESERVA
  function initReserva(){
    const actividades=[
      {nombre:"Clase de Yoga",precio:15},
      {nombre:"Acceso gimnasio",precio:5.5},
      {nombre:"Clase de Pilates",precio:15},
      {nombre:"Clase de Zumba",precio:15},
      {nombre:"Entrenamiento funcional",precio:15},
      {nombre:"Clase de Danza",precio:15},
    ];
    const cont=document.getElementById("actividades");cont.innerHTML="";
    actividades.forEach(a=>{
      const div=document.createElement("div");
      div.className="actividad";
      div.innerHTML=`<div>${a.nombre} — <span class="precio ${a.precio==5.5?"verde":"rojo"}">${a.precio}€</span></div>`;
      div.onclick=()=>{
        div.querySelectorAll("button").forEach(b=>b.remove());
        const btn=document.createElement("button");
        btn.className="btn "+(euros>=a.precio?"btn-gold":"btn-red");
        btn.textContent=euros>=a.precio?"Reservar":"Reservar y pagar diferencia en caja";
        btn.onclick=()=>{
          actividadSel=a.nombre;precioSel=a.precio;
          show("screen-confirmacion");initConfirm();
        };
        div.appendChild(btn);
      };
      cont.appendChild(div);
    });
    // monedero animado
    let start=Date.now(),dur=2000;
    function anim(){let p=Math.min(1,(Date.now()-start)/dur);document.getElementById("monedero").textContent=(euros*p).toFixed(2)+"€";if(p<1)requestAnimationFrame(anim);}
    anim();
  }

  // CONFIRMACION
  function initConfirm(){
    const ahorro=Math.min(euros,precioSel).toFixed(2);
    const pagar=(precioSel-euros>0?(precioSel-euros):0).toFixed(2);
    document.getElementById("resumen").innerHTML=`
      <div class="opcion">Opción: ${actividadSel}</div>
      <div class="ahorro">Ahorras: ${ahorro}€</div>
      <div class="pagar">A pagar: ${pagar}€</div>`;
    // contador
    let segundos=300;function tick(){let m=Math.floor(segundos/60),s=segundos%60;document.getElementById("contador").textContent=`${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;if(segundos>0){segundos--;setTimeout(tick,1000);}}tick();
    document.getElementById("fecha").min=new Date().toISOString().split("T")[0];
  }
})();
</script>
</body>
</html>
