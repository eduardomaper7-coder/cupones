<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reserva de actividad</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#111;color:#fff;padding:20px}
    h1{text-align:center;font-size:22px}
    h2{text-align:center;font-size:16px;font-weight:400;color:#ccc;margin-top:4px}
    .actividad{border:2px solid #333;padding:12px;margin:12px 0;border-radius:12px;cursor:pointer}
    .actividad .precio{font-weight:900;font-size:18px}
    .precio.rojo{color:#e11d48}
    .precio.verde{color:#16a34a}
    .boton{margin-top:8px;padding:10px 20px;border:none;border-radius:20px;font-weight:900;cursor:pointer}
    .reservar{background:#22c55e;color:#fff}
    .reservar-caja{background:#dc2626;color:#fff}
    .monedero{text-align:center;margin-top:30px;font-size:20px;font-weight:900;color:#facc15}
    .hidden{display:none}

    /* Confirmación (previa) */
    .contador-box{text-align:center;border:3px solid #facc15;padding:12px;border-radius:12px;margin:20px auto;width:180px;background:#1f1f1f;box-shadow:0 0 10px rgba(250,204,21,.5)}
    .contador{font-size:32px;color:#facc15;font-weight:900}
    .resumen{text-align:center;margin:20px 0}
    .opcion{font-size:24px;font-weight:900;margin-bottom:12px;color:#fff}
    .ahorro{font-size:22px;font-weight:900;color:#facc15;margin-bottom:8px}
    .pagar{font-size:20px;font-weight:700;color:#fff}

    label{display:block;margin:10px 0 4px}
    input{width:100%;padding:8px;border-radius:6px;border:none;margin-bottom:12px}
    /* Más espacio respecto al botón */
    input[type="email"]{margin-bottom:16px}
    button{padding:12px 24px;font-weight:900;background:#e11d48;color:#fff;border:none;border-radius:20px;cursor:pointer;margin-top:16px}

    /* Errores bajo los campos */
    .error-msg{color:#e11d48;font-size:12px;margin-top:-6px;margin-bottom:12px;display:none}

    /* Pantalla final bonita */
    .confirmacion-final{text-align:center;margin-top:60px;padding:30px;border:2px solid #22c55e;border-radius:16px;background:#1f1f1f;box-shadow:0 0 15px rgba(34,197,94,.4)}
    .confirmacion-final h1{font-size:24px;color:#22c55e;margin-bottom:16px}
    .confirmacion-final p{margin:8px 0;font-size:16px}
    .confirmacion-final .small{font-size:12px;color:#ccc;margin-top:12px}
  </style>
</head>
<body>

  <!-- Pantalla 1: RESERVA -->
  <div id="screen-reserva">
    <h1>Elige tu actividad</h1>
    <h2>Contamos con más de 100 centros afiliados cerca de ti.</h2>
    <div id="actividades"></div>
    <div class="monedero">Tu monedero: <span id="monedero">7.00€</span></div>
  </div>

  <!-- Pantalla 2: CONFIRMACIÓN -->
  <div id="screen-confirmacion" class="hidden">
    <h1 id="title-confirmacion">Confirmar reserva</h1>

    <!-- Contador y resumen (visibles en la pantalla de confirmar) -->
    <div class="contador-box"><div class="contador" id="contador">05:00</div></div>
    <div class="resumen" id="resumen"></div>

    <form id="form"
          method="POST"
          action="https://sheetdb.io/api/v1/uzddnfz5lg4c2"
          target="hidden_iframe">
      <input type="hidden" name="data[actividad]" id="actividad">

      <label for="centro">Centro deportivo más cercano</label>
      <input type="text" id="centro" value="Centro de ocio El Horno" readonly 
             style="font-weight:700; color:#333; background:#eee;">
      <input type="hidden" name="data[centro deportivo]" value="Centro de ocio El Horno">

      <label>Elige día</label>
      <input type="date" id="fecha" name="data[fecha]" required>
      <div id="error-fecha" class="error-msg">Fecha no disponible</div>

      <label>Elige hora</label>
      <input type="time" id="hora" name="data[hora]" required>
      <div id="error-hora" class="error-msg">Hora no disponible</div>

      <label>Nombre</label>
      <input type="text" name="data[nombre]" required>

      <label>Apellidos</label>
      <input type="text" name="data[apellidos]" required>

      <label>Correo electrónico</label>
      <input type="email" name="data[correo]" required>

      <button type="submit">Confirmar reserva</button>
    </form>
    <iframe name="hidden_iframe" style="display:none;"></iframe>

    <!-- Pantalla final (solo mensajes bonitos) -->
    <div id="confirmacion-final" class="hidden confirmacion-final">
      <h1>✅ Reserva confirmada con éxito</h1>
      <p>Le enviaremos su pase de acceso al correo.</p>
      <p>Muchas gracias.</p>
      <p class="small">Tiempo estimado: 1 minuto aprox.</p>
    </div>
  </div>

<script>
(function(){
  const actividades = [
    {nombre:"Clase de Yoga", precio:15},
    {nombre:"Acceso gimnasio", precio:5.50},
    {nombre:"Clase de Pilates", precio:15},
    {nombre:"Clase de Zumba", precio:15},
    {nombre:"Entrenamiento funcional", precio:15},
    {nombre:"Clase de Danza", precio:15},
  ];

  const totalGanado = 7; // siempre 7€
  const lista=document.getElementById("actividades");

  // Listar actividades
  actividades.forEach(act=>{
    const div=document.createElement("div");
    div.className="actividad";
    div.innerHTML=`<div>${act.nombre} — 
      <span class="precio ${act.precio==5.5?"verde":"rojo"}">${act.precio}€</span>
    </div>`;
    div.addEventListener("click",()=>{
      div.querySelectorAll("button").forEach(b=>b.remove());
      const btn=document.createElement("button");
      if(totalGanado>=act.precio){
        btn.textContent="Reservar";
        btn.className="boton reservar";
      }else{
        btn.textContent="Reservar y pagar diferencia en caja";
        btn.className="boton reservar-caja";
      }
      btn.onclick=(e)=>{ e.preventDefault(); goToConfirm(act); };
      div.appendChild(btn);
    });
    lista.appendChild(div);
  });

  let timerId=null;

  function goToConfirm(act){
    document.getElementById("screen-reserva").classList.add("hidden");
    document.getElementById("screen-confirmacion").classList.remove("hidden");

    const precio=act.precio;
    const ganado=totalGanado;
    const ahorro=Math.min(ganado,precio).toFixed(2);
    const pagar=(precio-ganado>0?(precio-ganado):0).toFixed(2);

    // Resumen visible en la pantalla de confirmar
    document.getElementById("resumen").innerHTML=`
      <div class="opcion">Opción: ${act.nombre}</div>
      <div class="ahorro">Ahorras: ${ahorro}€</div>
      <div class="pagar">A pagar: ${pagar}€</div>
    `;

    // Rellenar actividad en campo oculto
    document.getElementById("actividad").value = act.nombre;

    // Contador 5 min
    let segundos=300;
    (function tick(){
      let m=Math.floor(segundos/60);
      let s=segundos%60;
      document.getElementById("contador").textContent=
        `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
      if(segundos>0){
        segundos--;
        timerId=setTimeout(tick,1000);
      }
    })();

    // Fecha min/max
    const fecha=document.getElementById("fecha");
    const hoy=new Date();
    const max=new Date();
    max.setDate(hoy.getDate()+7);
    fecha.min=hoy.toISOString().split("T")[0];
    fecha.max=max.toISOString().split("T")[0];

    // Validación y envío
    const form=document.getElementById("form");
    form.onsubmit=function(e){
      e.preventDefault();

      // Ocultar mensajes previos
      document.getElementById("error-fecha").style.display="none";
      document.getElementById("error-hora").style.display="none";

      const horaEl=document.getElementById("hora");

      // Validar que haya valores
      if(!fecha.value){
        document.getElementById("error-fecha").textContent="Seleccione una fecha";
        document.getElementById("error-fecha").style.display="block";
        return;
      }
      if(!horaEl.value){
        document.getElementById("error-hora").textContent="Seleccione una hora";
        document.getElementById("error-hora").style.display="block";
        return;
      }

      const f=new Date(fecha.value+"T"+horaEl.value);
      const dia=f.getDay();
      const hora=f.getHours(), min=f.getMinutes();
      let valido=false;

      if(dia>=1 && dia<=5){
        if(hora>=10 && (hora<20 || (hora===20 && min<=30))) valido=true;
      }else if(dia===6){
        if(hora>=10 && (hora<13 || (hora===13 && min<=30))) valido=true;
      }else{
        document.getElementById("error-fecha").textContent="Domingo cerrado";
        document.getElementById("error-fecha").style.display="block";
        return;
      }
      if(!valido){
        document.getElementById("error-hora").textContent="Hora no disponible";
        document.getElementById("error-hora").style.display="block";
        return;
      }

      // Enviar al backend (iframe oculto) sin mostrar mensajes de Sheets
      form.submit();

      // Ocultar elementos de la pantalla de confirmar
      clearTimeout(timerId);
      document.getElementById("title-confirmacion").classList.add("hidden");
      form.classList.add("hidden");
      document.querySelector(".contador-box").classList.add("hidden");
      document.getElementById("resumen").classList.add("hidden");

      // Mostrar solo la pantalla final bonita
      document.getElementById("confirmacion-final").classList.remove("hidden");
    };
  }
})();
</script>
</body>
</html>











